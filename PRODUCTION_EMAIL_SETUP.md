# ๐ ุฅุนุฏุงุฏ ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ููุฅูุชุงุฌ - Production Email Setup

## โ ุงููุธุงู ุฌุงูุฒ ููุฅุฑุณุงู ุงูุญูููู ูุน ุฌููุน ุงูููุฒุงุช ุงููุทููุจุฉ

### ๐ฏ ูุนุงููุฑ ุงููุจูู ุงููุญููุฉ:
- โ **ุชุณููู ุงูุฑุณุงูุฉ ููุนููู** ูุน ูุณุฎุฉ CC ูููุฑุณู
- โ **ุฅุดุนุงุฑ ุงููุฌุงุญ ููุท ุจุนุฏ ุชุฃููุฏ SMTP** (Message-ID ุญูููู)
- โ **ุชุณุฌูู Message-ID ูุญุงูุฉ ุงูุฅุฑุณุงู** ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- โ **ุฅุฑูุงู PDF ุงูุตุญูุญ** ูููุงุชูุฑุฉ ุงููุฑุณูุฉ
- โ **ุฅุนุงุฏุฉ ุงูุฅุฑุณุงู** ููุนุงูุฌุฉ ุงููุดู

## ๐ง ุงูุฅุนุฏุงุฏ ุงูุณุฑูุน (5 ุฏูุงุฆู)

### ุงูุฎุทูุฉ 1: ุฅูุดุงุก ุญุณุงุจ Gmail ููุงุฎุชุจุงุฑ

1. ุฃูุดุฆ ุญุณุงุจ Gmail ุฌุฏูุฏ: `invoice.generator.test@gmail.com`
2. ูุนูู 2-Factor Authentication
3. ุฃูุดุฆ App Password:
   - ุงุฐูุจ ุฅูู [Google Account Settings](https://myaccount.google.com/)
   - Security โ App passwords
   - ุงุฎุชุฑ "Mail" โ "Other" โ "Invoice Generator"
   - ุงูุณุฎ ูููุฉ ุงููุฑูุฑ ุงูููููุฉ ูู 16 ุฑูู

### ุงูุฎุทูุฉ 2: ุชุญุฏูุซ .env.local

```bash
# Production Email Configuration
EMAIL_HOST=smtp.gmail.com
EMAIL_PORT=587
EMAIL_USER=invoice.generator.test@gmail.com
EMAIL_PASS=your-16-digit-app-password-here
EMAIL_FROM=invoice.generator.test@gmail.com
EMAIL_FROM_NAME=Karina Khrystych
EMAIL_CC=karina.backup@gmail.com
EMAIL_DEV_MODE=false
```

### ุงูุฎุทูุฉ 3: ุฅุนุงุฏุฉ ุชุดุบูู ุงูุฎุงุฏู

```bash
npm run dev
```

## ๐งช ุงุฎุชุจุงุฑ ุงููุธุงู

### 1. ุงุฎุชุจุงุฑ ุงูุชุดุฎูุต
```bash
curl http://localhost:3000/api/test-email-config
```

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:**
```json
{
  "diagnostics": {
    "provider": {
      "name": "Gmail",
      "host": "smtp.gmail.com"
    },
    "connection": {
      "status": "SUCCESS"
    }
  }
}
```

### 2. ุงุฎุชุจุงุฑ ุฅุฑุณุงู ูุงุชูุฑุฉ
1. ุงุฐูุจ ุฅูู ุฃู ูุงุชูุฑุฉ
2. ุงููุฑ ุนูู "Per E-Mail senden"
3. ุชุญูู ูู:
   - โ ูุตูู ุงูุจุฑูุฏ ููุนููู
   - โ ูุตูู ูุณุฎุฉ CC ูููุฑุณู
   - โ ุฅุฑูุงู PDF ุตุญูุญ

### 3. ูุญุต ุงูุณุฌูุงุช
```bash
curl http://localhost:3000/api/email-logs?stats=true
```

## ๐ ุงูููุฒุงุช ุงูุฌุฏูุฏุฉ ุงูููุทุจูุฉ

### 1. ุชุชุจุน ุดุงูู ููุจุฑูุฏ ุงูุฅููุชุฑููู
```javascript
// ูู ุจุฑูุฏ ุฅููุชุฑููู ููุณุฌู ูุน:
{
  id: "email-1758312635188-abc123",
  messageId: "real-smtp-message-id@gmail.com",
  status: "sent", // pending, sent, delivered, failed
  recipientEmail: "customer@example.com",
  ccEmail: "karina.backup@gmail.com",
  pdfSize: 45678,
  sentAt: "2025-09-19T20:15:30.000Z"
}
```

### 2. ูุณุฎุฉ CC ุชููุงุฆูุฉ
- โ ูุณุฎุฉ ุชุตู ูููุฑุณู ุชููุงุฆูุงู
- โ ุชุฃููุฏ ูู ุฑุณุงูุฉ ุงููุฌุงุญ
- โ ุชุณุฌูู ูู ุงูุณุฌูุงุช

### 3. ุฅุนุงุฏุฉ ุงูุฅุฑุณุงู
```bash
# ุฅุนุงุฏุฉ ุฅุฑุณุงู ุจุฑูุฏ ูุงุดู
curl -X POST http://localhost:3000/api/email-logs \
  -H "Content-Type: application/json" \
  -d '{
    "action": "retry",
    "logId": "email-1758312635188-abc123"
  }'
```

### 4. ุชุญูู ูู ุงูุงุณุชุฌุงุจุฉ ุงููุนููุฉ
- โ ุงููุฌุงุญ ููุธูุฑ ููุท ุจุนุฏ ุชุฃููุฏ SMTP
- โ Message-ID ุญูููู ูู ุงูุฎุงุฏู
- โ ุฑุณุงุฆู ุฎุทุฃ ูุญุฏุฏุฉ ูููุดู

## ๐ ูุฑุงูุจุฉ ุงูุฃุฏุงุก

### ุฅุญุตุงุฆูุงุช ุงูุจุฑูุฏ ุงูุฅููุชุฑููู
```bash
curl http://localhost:3000/api/email-logs?stats=true
```

**ุงููุชูุฌุฉ:**
```json
{
  "stats": {
    "total": 25,
    "sent": 23,
    "failed": 2,
    "successRate": 92.0
  }
}
```

### ุณุฌูุงุช ูุงุชูุฑุฉ ูุญุฏุฏุฉ
```bash
curl http://localhost:3000/api/email-logs?invoiceId=inv-123
```

### ุงูุจุฑูุฏ ุงููุงุดู
```bash
curl http://localhost:3000/api/email-logs?failed=true
```

## ๐ก๏ธ ุงูุฃูุงู ูุงูููุซูููุฉ

### 1. ุฅุนุฏุงุฏุงุช SMTP ูุญุณูุฉ
- โ **TLS Encryption**: ุงุชุตุงู ุขูู ูุน Gmail
- โ **Authentication**: App Password ุขูู
- โ **Rate Limiting**: ุงุญุชุฑุงู ุญุฏูุฏ Gmail
- โ **Error Handling**: ูุนุงูุฌุฉ ุดุงููุฉ ููุฃุฎุทุงุก

### 2. ุชุญุณููุงุช ุงูุจุฑูุฏ ุงูุฅููุชุฑููู
- โ **Reply-To**: ุนููุงู ุฑุฏ ุตุญูุญ
- โ **From Name**: ุงุณู ุงููุฑุณู ูุงุถุญ
- โ **Subject**: ููุถูุน ุงุญุชุฑุงูู ุฃููุงูู
- โ **HTML + Text**: ุฏุนู ุฌููุน ุนููุงุก ุงูุจุฑูุฏ

### 3. ุฅุฑูุงู PDF ูุญุณู
- โ **ุชุญูู ูู ุงูุญุฌู**: ุชุณุฌูู ุญุฌู PDF
- โ **ุงุณู ุงูููู**: `Rechnung_{invoiceNumber}.pdf`
- โ **Content-Type**: `application/pdf`
- โ **ุชุญูู ูู ุงูุฅูุดุงุก**: ูุดู ุฅุฐุง ูู ูููุดุฃ PDF

## ๐จ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุฎุทุฃ ุงููุตุงุฏูุฉ
```
Error: Invalid login: 535-5.7.8 Username and Password not accepted
```

**ุงูุญู:**
1. ุชุฃูุฏ ูู ุงุณุชุฎุฏุงู App Password (ูููุณ ูููุฉ ุงููุฑูุฑ ุงูุนุงุฏูุฉ)
2. ุชุญูู ูู ุชูุนูู 2FA
3. ุฃุนุฏ ุฅูุดุงุก App Password

### ุฎุทุฃ ุงูุงุชุตุงู
```
Error: connect ECONNREFUSED
```

**ุงูุญู:**
1. ุชุญูู ูู ุงูุงุชุตุงู ุจุงูุฅูุชุฑูุช
2. ุชุฃูุฏ ูู ุตุญุฉ HOST ู PORT
3. ุชุญูู ูู ุฅุนุฏุงุฏุงุช Firewall

### PDF ุบูุฑ ูููุดุฃ
```
Error: Failed to generate PDF for invoice
```

**ุงูุญู:**
1. ุชุญูู ูู ูุฌูุฏ ุงููุงุชูุฑุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
2. ุชุฃูุฏ ูู ุตุญุฉ ุจูุงูุงุช ุงููุงุชูุฑุฉ
3. ุฑุงุฌุน console logs ููุฃุฎุทุงุก

## ๐ ูุคุดุฑุงุช ุงููุฌุงุญ

### ุนูุงูุงุช ุงููุฌุงุญ:
```
โ Email sent successfully to customer@example.com
๐ Message ID: <real-message-id@gmail.com>
๐ Log ID: email-1758312635188-abc123
๐ง CC to: karina.backup@gmail.com
๐ PDF Size: 45678 bytes
```

### ุฑุณุงูุฉ ุงููุฌุงุญ ูู ุงููุงุฌูุฉ:
```
"Rechnung RE-2024-001 wurde erfolgreich an customer@example.com gesendet. 
Eine Kopie wurde an karina.backup@gmail.com gesendet."
```

## ๐ ุงูุฎูุงุตุฉ

โ **ุงููุธุงู ุฌุงูุฒ ููุฅูุชุงุฌ ุจุงููุงูู!**

**ุงูููุฒุงุช ุงูููุทุจูุฉ:**
- ๐ง **ุฅุฑุณุงู ุญูููู** ูุน Gmail SMTP
- ๐ **ุชุชุจุน ุดุงูู** ููุจุฑูุฏ ุงูุฅููุชุฑููู
- ๐ **PDF ูุฑูู** ุชููุงุฆูุงู
- ๐ **ูุณุฎุฉ CC** ูููุฑุณู
- ๐ **ุฅุนุงุฏุฉ ุงูุฅุฑุณุงู** ูููุงุดู
- ๐ **ุฅุญุตุงุฆูุงุช ููุตูุฉ**
- ๐ก๏ธ **ุฃูุงู ูุญุณู**

**ููุงุณุชุฎุฏุงู ุงูููุฑู:**
1. ุฃุฏุฎู ุจูุงูุงุช Gmail ุงูุตุญูุญุฉ ูู `.env.local`
2. ุฃุนุฏ ุชุดุบูู ุงูุฎุงุฏู
3. ุงุฎุชุจุฑ ุฅุฑุณุงู ูุงุชูุฑุฉ
4. ุชุญูู ูู ูุตูู ุงูุจุฑูุฏ ูุงููุณุฎุฉ

**ุงูุขู ุงููุธุงู ูุฑุณู ููุงุชูุฑ ุญููููุฉ ุจุดูู ุงุญุชุฑุงูู!** ๐
