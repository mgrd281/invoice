# โ ุฅุตูุงุญ CSV Export ููููุงุชูุฑ ุงูุญููููุฉ

## ๐จ ุงููุดููุฉ ุงูุฃุตููุฉ
```
ูุง ูููู ุจุชุตุฏูุฑ ููุงุชูุฑ ุงูุญููููุฉ !!
```

## ๐ง ุงูุญู ุงููุทุจู

### **ุงููุดููุฉ:**
- ูุงู ุงููุธุงู ูุณุชุฎุฏู ุจูุงูุงุช ุชุฌุฑูุจูุฉ ููุท
- ูู ููู ูุชุตู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช ุงูุญููููุฉ ููููุงุชูุฑ
- ุชุฌุงูู ุงูููุงุชูุฑ ุงูููุฌูุฏุฉ ูู ุงููุธุงู

### **ุงูุญู ุงูุฌุฏูุฏ:**

#### **1. ุฑุจุท ูุน ูุตุฏุฑ ุงูุจูุงูุงุช ุงูุญูููู**
```typescript
// ุงุณุชุฎุฏุงู ููุณ ูุตุฏุฑ ุงูุจูุงูุงุช ููุง ูู /api/invoices
const allInvoices = [
  ...(global.csvInvoices || []),      // ููุงุชูุฑ ูู CSV
  ...(global.allInvoices || [])       // ููุงุชูุฑ ูููุดุฃุฉ ูุฏููุงู
]
```

#### **2. ุชุทุจูู ุตูุงุญูุงุช ุงููุณุชุฎุฏู**
```typescript
// Admin ูุฑู ูู ุงูููุงุชูุฑุ ุงููุณุชุฎุฏู ุงูุนุงุฏู ูุฑู ููุงุชูุฑู ููุท
if (shouldShowAllData(user)) {
  filteredInvoices = allInvoices.filter(invoice => !invoice.deleted_at)
} else {
  filteredInvoices = allInvoices.filter(invoice => 
    !invoice.deleted_at && invoice.userId === user.id
  )
}
```

#### **3. ุชุญููู ุงูุจูุงูุงุช ุงูุญููููุฉ ูุชูุณูู CSV**
```typescript
return filteredInvoices.map((invoice: any) => {
  const verkaufspreis = parseFloat(invoice.total) || parseFloat(invoice.amount) || 0
  
  return {
    id: invoice.id,
    datum: new Date(invoice.createdAt || invoice.date),
    produktname: invoice.items?.[0]?.description || invoice.customerName || 'Rechnung',
    bestellnummer: invoice.invoiceNumber || invoice.number || invoice.id,
    kategorie: invoice.category || 'Dienstleistung',
    verkaufspreis: Math.round(verkaufspreis * 100) / 100,
    // ... ุจุงูู ุงูุญุณุงุจุงุช
  }
})
```

#### **4. Fallback ุฐูู**
```typescript
// ุฅุฐุง ูู ุชูุฌุฏ ููุงุชูุฑ ุญููููุฉุ ุงุณุชุฎุฏู ุงูุจูุงูุงุช ุงูุชุฌุฑูุจูุฉ
if (realInvoiceData.length === 0) {
  console.log('โ๏ธ No real invoices found, using demo data as fallback')
  realInvoiceData = generateDemoInvoiceData()
}
```

## ๐ ูุง ูุญุฏุซ ุงูุขู

### **ุนูุฏ ุงูุถุบุท ุนูู CSV Export:**

#### **ุงูุณููุงุฑูู 1: ููุฌุฏ ููุงุชูุฑ ุญููููุฉ**
- โ **ูุญูู ุงูููุงุชูุฑ ุงูุญููููุฉ** ูู ุงููุธุงู
- โ **ูุทุจู ุตูุงุญูุงุช ุงููุณุชุฎุฏู** (admin ูุฑู ุงูููุ user ูุฑู ููุงุชูุฑู)
- โ **ูุณุชุฎุฏู ุงูุจูุงูุงุช ุงููุนููุฉ** (ุฃุณูุงุก ุงูุนููุงุกุ ุงููุจุงูุบุ ุงูุชูุงุฑูุฎ)
- โ **ูุญุณุจ ุงูููู ุงููุงููุฉ** ุจูุงุกู ุนูู ุงููุจุงูุบ ุงูุญููููุฉ

#### **ุงูุณููุงุฑูู 2: ูุง ุชูุฌุฏ ููุงุชูุฑ ุญููููุฉ**
- โ **ูุณุชุฎุฏู ุงูุจูุงูุงุช ุงูุชุฌุฑูุจูุฉ** ูู fallback
- โ **ูุนุฑุถ ุฑุณุงูุฉ ูุงุถุญุฉ** ูู ุงูู console

### **ุงูุจูุงูุงุช ุงููุตุฏุฑุฉ ุงูุขู:**

#### **ูู ุงูููุงุชูุฑ ุงูุญููููุฉ:**
- **ุงูุชุงุฑูุฎ**: ูู `createdAt` ุฃู `date` ุงููุงุชูุฑุฉ ุงูุญููููุฉ
- **ุงุณู ุงูููุชุฌ/ุงูุฎุฏูุฉ**: ูู `items[0].description` ุฃู `customerName`
- **ุฑูู ุงููุงุชูุฑุฉ**: ูู `invoiceNumber` ุฃู `number`
- **ุงููุจูุบ**: ูู `total` ุฃู `amount` ุงููุงุชูุฑุฉ ุงูุญููููุฉ
- **ุงููุฆุฉ**: ูู `category` ุฃู ุงูุชุฑุงุถู "Dienstleistung"

#### **ูุญุณูุจุฉ ุชููุงุฆูุงู:**
- **MwSt (19%)**: ูู ุงููุจูุบ ุงูุญูููู
- **ุชูููุฉ ุงูุดุฑุงุก**: 60% ูู ุงููุจูุบ ุงูุญูููู
- **ุฑุณูู ุฃูุงุฒูู**: 15% ูู ุงููุจูุบ ุงูุญูููู
- **ุงูุฑุจุญ**: ูุญุณูุจ ูู ุงููุจูุบ ุงูุญูููู

## ๐งช ููููุฉ ุงูุงุฎุชุจุงุฑ

### **1. ูุน ููุงุชูุฑ ุญููููุฉ:**
1. ุชุฃูุฏ ูู ูุฌูุฏ ููุงุชูุฑ ูู `/invoices`
2. ุงุถุบุท "CSV Export"
3. **ุงููุชูุฌุฉ**: ูุฌุจ ุฃู ูุตุฏุฑ ููุงุชูุฑู ุงูุญููููุฉ

### **2. ุจุฏูู ููุงุชูุฑ ุญููููุฉ:**
1. ุฅุฐุง ูู ุชูุฌุฏ ููุงุชูุฑ ูู ุงููุธุงู
2. ุงุถุบุท "CSV Export"
3. **ุงููุชูุฌุฉ**: ูุณุชุฎุฏู ุงูุจูุงูุงุช ุงูุชุฌุฑูุจูุฉ ูู fallback

### **3. ููุชุฃูุฏ ูู ุงูุจูุงูุงุช ุงูุญููููุฉ:**
- ุงูุชุญ ููู CSV
- ุชุญูู ูู ุฃุณูุงุก ุงูุนููุงุก ูุฃุฑูุงู ุงูููุงุชูุฑ
- ูุฌุจ ุฃู ุชุทุงุจู ูุง ุชุฑุงู ูู `/invoices`

## ๐ ููููุฉ ุงูุชูููุฒ

### **ูู Console ุณุชุฑู:**
```
๐ Processing 5 invoices for CSV export (real data)
```
ุฃู
```
๐ Processing 20 invoices for CSV export (demo data)
```

### **ูู ููู CSV:**
- **ุงูุจูุงูุงุช ุงูุญููููุฉ**: ุฃุณูุงุก ุนููุงุก ุญููููุฉุ ุฃุฑูุงู ููุงุชูุฑ ูู ุงููุธุงู
- **ุงูุจูุงูุงุช ุงูุชุฌุฑูุจูุฉ**: iPhone 15 Pro, Samsung Galaxy S24, ุฅูุฎ

## ๐ฏ ุงููุชูุฌุฉ ุงูููุงุฆูุฉ

ุงูุขู CSV Export:
- โ **ูุตุฏุฑ ุงูููุงุชูุฑ ุงูุญููููุฉ** ุฅุฐุง ููุฌุฏุช
- โ **ูุญุชุฑู ุตูุงุญูุงุช ุงููุณุชุฎุฏู** (admin vs user)
- โ **ูุณุชุฎุฏู ุงูุจูุงูุงุช ุงููุนููุฉ** (ุนููุงุกุ ูุจุงูุบุ ุชูุงุฑูุฎ)
- โ **ูุญุณุจ ุงูููู ุงููุงููุฉ** ูู ุงููุจุงูุบ ุงูุญููููุฉ
- โ **Fallback ุฐูู** ููุจูุงูุงุช ุงูุชุฌุฑูุจูุฉ ุนูุฏ ุงูุญุงุฌุฉ

## ๐ ุงุฎุชุจุฑ ุงูุขู!

1. **ุงุฐูุจ ุฅูู** `/invoices`
2. **ุชุฃูุฏ ูู ูุฌูุฏ ููุงุชูุฑ** ูู ุงููุงุฆูุฉ
3. **ุงุถุบุท "CSV Export"** (ุงูุฒุฑ ุงูุฃุฒุฑู)
4. **ุงูุชุญ ุงูููู** ูุชุญูู ูู ุงูุจูุงูุงุช ุงูุญููููุฉ

**ุงูุขู ูุตุฏุฑ ููุงุชูุฑู ุงูุญููููุฉ!** ๐
